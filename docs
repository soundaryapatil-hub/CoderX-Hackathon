<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Women Safety Route Analysis</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body { font-family: Arial; text-align: center; padding: 10px; }
.box {
height: 420px;
border: 2px solid black;
margin: 20px auto;
width: 90%;
max-width: 950px;
}
#map { height: 100%; width: 100%; }
.safe { color: green; font-weight: bold; }
.danger { color: red; font-weight: bold; }
select { padding: 6px; margin: 0 5px; }
button { padding: 8px 14px; cursor: pointer; }
</style>
</head>

<body>

<h2>Women Safety Route Analysis</h2>

<select id="source"></select>
<select id="destination"></select>

<select id="time">
<option value="0">Day</option>
<option value="1">Night</option>
</select>

<br><br>
<button id="btn">Check Safety</button>

<div class="box">
<div id="map"></div>
</div>

<h3 id="result"></h3>

<script>

var areas = {
"Rani Chennamma Circle": { crime: 14, crowd: 27, lat: 15.8497, lng: 74.4977 },
"Tilakwadi": { crime: 16, crowd: 25, lat: 15.8526, lng: 74.5057 },
"Shahapur": { crime: 29, crowd: 25, lat: 15.8466, lng: 74.5169 },
"Angol": { crime: 15, crowd: 17, lat: 15.8589, lng: 74.5085 },
"KLE Hospital": { crime: 3, crowd: 58, lat: 15.8572, lng: 74.5257 }
};

function calculateRisk(c1, cr1, c2, cr2, t) {
var avgCrime = (c1 + c2) / 2;
var avgCrowd = (cr1 + cr2) / 2;
var risk = (avgCrime * 0.6) + (t * 4) - (avgCrowd * 0.3);
return Math.round(risk * 100) / 100;
}

var sourceSel = document.getElementById("source");
var destSel = document.getElementById("destination");

for (var name in areas) {
var o1 = document.createElement("option");
o1.text = name;
sourceSel.add(o1);

var o2 = document.createElement("option");
o2.text = name;
destSel.add(o2);
}

sourceSel.value = "Tilakwadi";
destSel.value = "Rani Chennamma Circle";

var map = L.map("map").setView([15.8526, 74.5057], 13);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
maxZoom: 19,
attribution: "&copy; OpenStreetMap"
}).addTo(map);

var sourceMarker = null;
var destMarker = null;
var routeLine = null;

function clearOldRoute() {
if (sourceMarker) map.removeLayer(sourceMarker);
if (destMarker) map.removeLayer(destMarker);
if (routeLine) map.removeLayer(routeLine);
sourceMarker = null;
destMarker = null;
routeLine = null;
}

function drawStraightLine(s, d, color) {
routeLine = L.polyline([[s.lat, s.lng], [d.lat, d.lng]], {
color: color,
weight: 7,
opacity: 0.9
}).addTo(map);
map.fitBounds(routeLine.getBounds(), { padding: [30, 30] });
}

function drawRoute(src, dst, color) {
var s = areas[src];
var d = areas[dst];

clearOldRoute();

sourceMarker = L.marker([s.lat, s.lng]).addTo(map);
destMarker = L.marker([d.lat, d.lng]).addTo(map);

if (src === dst) {
routeLine = L.circle([s.lat, s.lng], {
radius: 250,
color: color,
weight: 7
}).addTo(map);
map.setView([s.lat, s.lng], 14);
return;
}

var url = "https://router.project-osrm.org/route/v1/driving/"
+ s.lng + "," + s.lat + ";"
+ d.lng + "," + d.lat
+ "?overview=full&geometries=geojson";

var xhr = new XMLHttpRequest();
xhr.open("GET", url, true);
xhr.timeout = 7000;

xhr.onreadystatechange = function() {
if (xhr.readyState !== 4) return;

try {
if (xhr.status === 200) {
var data = JSON.parse(xhr.responseText);
if (data.routes && data.routes.length > 0) {
var coords = data.routes[0].geometry.coordinates;
var latLngs = [];
for (var i = 0; i < coords.length; i++) {
latLngs.push([coords[i][1], coords[i][0]]);
}
routeLine = L.polyline(latLngs, {
color: color,
weight: 7,
opacity: 0.9
}).addTo(map);
map.fitBounds(routeLine.getBounds(), { padding: [30, 30] });
return;
}
}
} catch (e) {}

drawStraightLine(s, d, color);
};

xhr.ontimeout = function() {
drawStraightLine(s, d, color);
};

xhr.send();
}

function checkRoute() {
var src = sourceSel.value;
var dst = destSel.value;
var time = parseInt(document.getElementById("time").value);

var s = areas[src];
var d = areas[dst];

var score = calculateRisk(s.crime, s.crowd, d.crime, d.crowd, time);

var color = score > 7 ? "red" : "green";

drawRoute(src, dst, color);

var result = document.getElementById("result");

if (score > 7) {
result.innerHTML = "High Risk Route | Score: " + score;
result.className = "danger";
} else {
result.innerHTML = "Safer Route | Score: " + score;
result.className = "safe";
}
}

document.getElementById("btn").onclick = checkRoute;

checkRoute();

</script>

</body>
</html>
